<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crown Career - Final Invoice System</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        :root { --primary: #003366; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #525659; margin: 0; padding: 0; }

        /* কন্ট্রোল প্যানেল যা প্রিন্টে আসবে না */
        .no-print {
            max-width: 800px; margin: 20px auto; background: #fff; padding: 20px;
            border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        /* মূল ইনভয়েস - A4 সাইজ ফিক্সড (210mm x 297mm) */
        #invoice {
            width: 210mm;
            height: 296mm; /* সামান্য কম রাখা হয়েছে যাতে ২য় পেজে না যায় */
            margin: 0 auto;
            background: #fff;
            padding: 20mm;
            box-sizing: border-box;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 15px rgba(0,0,0,0.5);
        }

        /* ওয়াটারমার্ক ডিজাইন */
        #wtm-container {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; justify-content: center; align-items: center;
            opacity: 0.1; pointer-events: none; z-index: 0;
        }
        #wtm-text-view { font-size: 80pt; font-weight: 900; transform: rotate(-45deg); color: #000; text-transform: uppercase; }
        #wtm-img-view { width: 140mm; transform: rotate(-45deg); display: none; }

        /* ইনভয়েস কন্টেন্ট */
        .header { display: flex; justify-content: space-between; border-bottom: 3px solid var(--primary); padding-bottom: 15px; position: relative; z-index: 1; }
        .logo { max-height: 60px; margin-bottom: 5px; }
        .inv-table { width: 100%; border-collapse: collapse; margin-top: 30px; position: relative; z-index: 1; }
        .inv-table th, .inv-table td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        .inv-table th { background: #f4f4f4; color: var(--primary); }

        .footer { position: absolute; bottom: 20mm; left: 20mm; right: 20mm; display: flex; justify-content: space-between; }
        .sig-box { border-top: 2px solid #333; width: 180px; text-align: center; padding-top: 5px; font-weight: bold; }

        /* ইনপুট স্টাইল */
        .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 15px; }
        input { padding: 10px; border: 1px solid #ccc; border-radius: 4px; width: 100%; box-sizing: border-box; }
        button { padding: 12px 25px; background: var(--primary); color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }
        button:hover { background: #002244; }
    </style>
</head>
<body>

<div class="no-print">
    <h3 style="margin-top:0;">Invoice Settings</h3>
    <div class="grid">
        <input type="file" accept="image/*" onchange="previewMedia(event, 'logo-view')">
        <input type="text" id="wtmIn" placeholder="Watermark Text" oninput="updateSync()">
        <input type="file" accept="image/*" onchange="previewMedia(event, 'wtm-img-view')">
    </div>
    <div class="grid">
        <input type="text" id="invNoIn" placeholder="Invoice Number" oninput="updateSync()">
        <input type="text" id="cNameIn" placeholder="Customer Name" oninput="updateSync()">
        <button onclick="generatePDF()">DOWNLOAD PDF</button>
    </div>
</div>

<div id="invoice">
    <div id="wtm-container">
        <span id="wtm-text-view"></span>
        <img id="wtm-img-view">
    </div>

    <div class="header">
        <div>
            <img id="logo-view" class="logo" style="display:none;">
            <h1 style="margin:0; color:var(--primary);">Crown Career</h1>
            <p style="margin:2px 0; font-size:12px;">Dhanmondi, Dhaka, Bangladesh</p>
        </div>
        <div style="text-align: right;">
            <h2 style="margin:0; color:#ddd; font-size: 40px;">INVOICE</h2>
            <p>No: <span id="outInv">---</span></p>
            <p>Date: <span id="outDate"></span></p>
        </div>
    </div>

    <div style="margin-top: 40px; position: relative; z-index: 1;">
        <p><strong>Customer:</strong> <span id="outName">Walking Customer</span></p>
    </div>

    <table class="inv-table">
        <thead>
            <tr>
                <th style="width: 50px;">SL</th>
                <th>Description</th>
                <th style="width: 150px;">Amount</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>01</td>
                <td>General Service / Consultation</td>
                <td>0.00 BDT</td>
            </tr>
        </tbody>
    </table>

    <div class="footer">
        <div class="sig-box">Customer Signature</div>
        <div class="sig-box">Authorized Signature</div>
    </div>
</div>

<script>
    // আজকের তারিখ সেট করা
    document.getElementById('outDate').innerText = new Date().toLocaleDateString('en-GB');

    function previewMedia(event, targetId) {
        var reader = new FileReader();
        reader.onload = function() {
            var el = document.getElementById(targetId);
            el.src = reader.result;
            el.style.display = "block";
            if(targetId === 'wtm-img-view') document.getElementById('wtm-text-view').style.display='none';
        };
        reader.readAsDataURL(event.target.files[0]);
    }

    function updateSync() {
        document.getElementById('outInv').innerText = document.getElementById('invNoIn').value || "---";
        document.getElementById('outName').innerText = document.getElementById('cNameIn').value || "Walking Customer";
        document.getElementById('wtm-text-view').innerText = document.getElementById('wtmIn').value;
    }

    function generatePDF() {
        const element = document.getElementById('invoice');
        
        // GitHub Pages এর জন্য সবচাইতে শক্তিশালী PDF কনফিগারেশন
        const opt = {
            margin: 0,
            filename: 'Invoice_' + (document.getElementById('invNoIn').value || 'New') + '.pdf',
            image: { type: 'jpeg', quality: 1 },
            html2canvas: { 
                scale: 2, 
                useCORS: true, 
                logging: false,
                width: 793, // A4 pixel width at 96 DPI
                height: 1122 // A4 pixel height at 96 DPI
            },
            jsPDF: { 
                unit: 'mm', 
                format: 'a4', 
                orientation: 'portrait' 
            }
        };

        html2pdf().set(opt).from(element).save();
    }
</script>

</body>
</html>
